
 -- Lista todos os pedidos com nome do cliente e data ---
SELECT 
  p.PEDIDO_ID,
  c.NOME AS CLIENTE,
  p.DATA_PEDIDO
FROM PEDIDOS p
JOIN CLIENTES c ON p.CLIENTE_ID = c.CLIENTE_ID;

 -- Total gasto por pedido (com base nos itens e pre√ßo dos produtos) --
SELECT 
  ip.PEDIDO_ID,
  SUM(ip.QUANTIDADE * pr.PRECO) AS TOTAL_PEDIDO
FROM ITENS_PEDIDO ip
JOIN PRODUTO pr ON ip.PRODUTO_ID = pr.PRODUTOS_ID
GROUP BY ip.PEDIDO_ID;

 -- Cliente que mais gastou --
SELECT TOP 1
  c.NOME,
  SUM(ip.QUANTIDADE * pr.PRECO) AS TOTAL_GASTO
FROM CLIENTES c
JOIN PEDIDOS p ON c.CLIENTE_ID = p.CLIENTE_ID
JOIN ITENS_PEDIDO ip ON p.PEDIDO_ID = ip.PEDIDO_ID
JOIN PRODUTO pr ON ip.PRODUTO_ID = pr.PRODUTOS_ID
GROUP BY c.NOME
ORDER BY TOTAL_GASTO DESC;

 -- Produtos mais vendidos (por quantidade) --
SELECT 
  pr.NOME_PRODUTO,
  SUM(ip.QUANTIDADE) AS TOTAL_VENDIDO
FROM ITENS_PEDIDO ip
JOIN PRODUTO pr ON ip.PRODUTO_ID = pr.PRODUTOS_ID
GROUP BY pr.NOME_PRODUTO
ORDER BY TOTAL_VENDIDO DESC;

ALTER TABLE ITENS_PEDIDO
ALTER COLUMN QUANTIDADE INT;

 -- Total de vendas por cidade --
SELECT 
  c.CIDADE,
  SUM(ip.QUANTIDADE * pr.PRECO) AS TOTAL_VENDAS
FROM CLIENTES c
JOIN PEDIDOS p ON c.CLIENTE_ID = p.CLIENTE_ID
JOIN ITENS_PEDIDO ip ON p.PEDIDO_ID = ip.PEDIDO_ID
JOIN PRODUTO pr ON ip.PRODUTO_ID = pr.PRODUTOS_ID
GROUP BY c.CIDADE
ORDER BY TOTAL_VENDAS DESC;